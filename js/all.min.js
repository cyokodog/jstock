var app=angular.module("app",["ui.router","ngAnimate","angular-loading-bar"]);app.constant("CONFIG",{API_ENDPOINT:"http://jquerydb.aws.af.cm/jstock/webapi/",PAGE_INFO:[{id:"home",name:"HOME"},{id:"library",name:"LIBRARY"},{id:"jser",name:"JSer"}]}),app.factory("fetchCategoryService",["$http","$q","CONFIG",function(e,t,r){return{exec:function(a){var i=t.defer();return e.jsonp(r.API_ENDPOINT,{params:angular.extend({callback:"JSON_CALLBACK",contentsType:"category"},a)}).success(function(e){i.resolve(e)}),i.promise}}}]),app.factory("fetchArticleService",["$http","$q","CONFIG",function(e,t,r){return{exec:function(a){["page","page_no","category_id","single_id"].forEach(function(e){a[e]=a[e]||"*"});var i=t.defer();return e.jsonp(r.API_ENDPOINT,{params:angular.extend({callback:"JSON_CALLBACK",contentsType:"article"},a)}).success(function(e){i.resolve(e)}),i.promise}}}]),app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,r){function a(e,t){this.init.apply(this,Array.prototype.slice.call(arguments))}var i={template:'<list-page ctrl="ctrl" data="ctrl.data" state="ctrl.state"/>',controllerAs:"ctrl",controller:a},c={template:'<article-page ctrl="ctrl" data="ctrl.data" state="ctrl.state"/>',controllerAs:"ctrl",controller:a};t.otherwise("/"),e.state("home",{url:"/",views:{viewArticle:i}}).state("category",{url:"/{pageId:library|jser}/category/{categoryId:.+}",views:{viewArticle:i}}).state("page",{url:"/{pageId:library|jser}",views:{viewArticle:i}}).state("article",{url:"/{pageId:library|jser}/{articleId:.+}",views:{viewArticle:c}}),a.$inject=["$stateParams","fetchArticleService"],angular.extend(a.prototype,{init:function(e,t){var r=this,a=r.config={fetchArticleService:t,pageNo:1};r.state=e,r.fetchData(a.pageNo)},initJserCategory:function(){{var e=this;e.config}"jser"==e.state.pageId&&(e.data.plugins_qty>0?e.data.jserCategory="1"==e.data.jp_flg?{type:"japanese-creator",name:"Japanese Creator"}:{type:"creator",name:"Creator"}:"1"==e.data.jp_flg&&(e.data.jserCategory={type:"japanese-reviewer",name:"Japanese Reviewer"}))},fetchData:function(e){var t=this,r=t.config;r.fetchArticleService.exec({page:t.state.pageId||"home",page_no:r.pageNo,category_id:t.state.categoryId||"*",single_id:t.state.articleId||"*"}).then(function(e){t.data=e,t.data.info=e.article_list_info[0],t.data.isNextPage=t.data.info.next_page_no>r.pageNo,t.data.isPrevPage=1<r.pageNo,t.initJserCategory(),setTimeout(function(){document.body.scrollTop=0},0)})},nextPage:function(){var e=this,t=e.config;t.pageNo++,e.fetchData(t.pageNo)},prevPage:function(){var e=this,t=e.config;t.pageNo--,e.fetchData(t.pageNo)}})}]),app.directive("siteNav",function(){return{scope:{},restrict:"E",templateUrl:"directive/site_nav.html",controllerAs:"ctrl",controller:["CONFIG","$stateParams",function(e,t){var r=this;r.pageInfo=e.PAGE_INFO,r.state=t}]}}),app.directive("listPage",function(){return{scope:{c:"=ctrl",d:"=data",s:"=state"},restrict:"E",templateUrl:"directive/list_page.html"}}),app.directive("articlePage",function(){return{scope:{c:"=ctrl",d:"=data",s:"=state"},restrict:"E",templateUrl:"directive/article_page.html"}}),app.directive("libraryCard",function(){return{scope:{c:"=ctrl",d:"=data",s:"=state"},restrict:"E",templateUrl:"directive/library_card.html"}}),app.directive("jserCard",function(){return{scope:{c:"=ctrl",d:"=data",s:"=state"},restrict:"E",templateUrl:"directive/jser_card.html"}}),app.directive("libraryArticle",function(){return{scope:{c:"=ctrl",d:"=data",s:"=state"},restrict:"E",templateUrl:"directive/library_article.html"}}),app.directive("jserArticle",function(){return{scope:{c:"=ctrl",d:"=data",s:"=state"},restrict:"E",templateUrl:"directive/jser_article.html"}}),app.directive("categoryList",function(){return{scope:{},require:"categoryList",restrict:"E",templateUrl:"directive/category_list.html",link:function(e,t,r,a){a.init()},controllerAs:"ctrl",controller:["$scope","fetchCategoryService",function(e,t){var r=this;r.data={},r.init=function(){t.exec().then(function(e){r.data.category=e})}}]}});